<h1 id="blackberry-plugins">BlackBerry Plugins</h1>

<p>This section provides details for how to implement native plugin code
on the BlackBerry platform. Before reading this, see Application
Plugins for an overview of the plugin’s structure and its common
JavaScript interface. This section continues to demonstrate the sample
<em>echo</em> plugin that communicates from the Cordova webview to the native
platform and back.</p>

<p>In addition, download the <a href="https://git-wip-us.apache.org/repos/asf?p=cordova-blackberry.git;a=summary">Cordova BlackBerry
repository</a>.
The <code class="language-plaintext highlighter-rouge">Cordova-BlackBerry</code> project allows you to deploy to BlackBerry
devices such as the Torch, Bold, and Playbook. The Playbook uses a
different code base than other BlackBerry handheld devices, for which
you need to duplicate your development efforts.  This guide focuses on
handheld devices rather than tablets.</p>

<h2 id="modifying-pluginsxml">Modifying plugins.xml</h2>

<p>The <code class="language-plaintext highlighter-rouge">Echo</code> plugin returns whatever message a user sends with the
<code class="language-plaintext highlighter-rouge">window.echo</code> function on the JavaScript side:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    window.echo = function(str, callback) {
        cordova.exec(callback, function(err) {
            callback('Nothing to echo.');
        }, "Echo", "echo", [str]);
    };
</code></pre></div></div>

<p>The project’s <code class="language-plaintext highlighter-rouge">www/plugins.xml</code> file contains all of the necessary
references to the Cordova project’s plugins. Add an additional
reference so that when <code class="language-plaintext highlighter-rouge">cordova.exec</code> is called, Cordova knows how to
map the <code class="language-plaintext highlighter-rouge">Echo</code> argument to the native <code class="language-plaintext highlighter-rouge">Echo</code> class:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;feature name="Echo"&gt;
        &lt;param name="blackberry-package" value="org.apache.cordova.echo.Echo" /&gt;
    &lt;/feature&gt;
</code></pre></div></div>

<h2 id="the-echojava-file">The Echo.java File</h2>

<p>The <code class="language-plaintext highlighter-rouge">feature</code> specification’s <code class="language-plaintext highlighter-rouge">value</code> attribute references a reverse
domain-style identifier. This corresponds to a path within the Cordova
BlackBerry WebWorks repo’s <code class="language-plaintext highlighter-rouge">framework/ext/src</code> directory.  Add a
<code class="language-plaintext highlighter-rouge">framework/ext/src/org/apache/cordova/echo</code> directory and add a
<code class="language-plaintext highlighter-rouge">Echo.java</code> file.</p>

<p>The <code class="language-plaintext highlighter-rouge">Echo.java</code> needs to define a class that extends the <code class="language-plaintext highlighter-rouge">Plugin</code>
class. It also needs to implement an <code class="language-plaintext highlighter-rouge">execute</code> method that returns a
<code class="language-plaintext highlighter-rouge">PluginResult</code> class.  Any call to <code class="language-plaintext highlighter-rouge">cordova.exec</code> passes in the action
within the class to execute, as well as the arguments. In this case,
the <code class="language-plaintext highlighter-rouge">Echo</code> class’s <code class="language-plaintext highlighter-rouge">echo</code> method is the action, and <code class="language-plaintext highlighter-rouge">[str]</code> is an
additional argument to pass to the method.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    package org.apache.cordova.echo;

    import org.apache.cordova.api.Plugin;
    import org.apache.cordova.api.PluginResult;
    import org.apache.cordova.json4j.JSONArray;
    import org.apache.cordova.json4j.JSONException;
    import org.apache.cordova.json4j.JSONObject;
    /**
     * A simple plugin to demonstrate how to build a plugin for BlackBerry
     * Basically echos back the msg that a user calls to this plugin
     */
    public final class Echo extends Plugin {

        public static final String echo = "echo";

        public PluginResult execute(String action, JSONArray args, String callbackId) {
            PluginResult result = new PluginResult(PluginResult.Status.INVALID_ACTION, "Echo: Invalid action:" + action);
            if(action.equals(echo)){
                try {
                    String theMsg = args.getString(0);
                    if(theMsg!= null || theMsg.length()&gt;0){
                        result = new PluginResult(PluginResult.Status.OK, theMsg);
                    }else{
                        result = new PluginResult(PluginResult.Status.ERROR, "Nothing to echo.");
                    }
                } catch (JSONException e) {
                    result = new PluginResult(PluginResult.Status.JSON_EXCEPTION, e.getMessage());
                }
            }
            return result;
        }
    }
</code></pre></div></div>

<p>In the code above, the <code class="language-plaintext highlighter-rouge">execute</code> method first brings in an action. In
this case, there is only one valid <code class="language-plaintext highlighter-rouge">echo</code> action, so it simply checks
for that value.</p>

<p>The incoming message passed in as <code class="language-plaintext highlighter-rouge">[str]</code> from JavaScript is available
to the <code class="language-plaintext highlighter-rouge">Echo</code> class as an <code class="language-plaintext highlighter-rouge">args</code> array. In this case, there is only
one argument, accessible using a zero-based array index:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    String theMsg = args.getString(0);
</code></pre></div></div>

<p>After various error-checking on the message’s value, the method
instantiates a new <code class="language-plaintext highlighter-rouge">PluginResult</code> with an <code class="language-plaintext highlighter-rouge">OK</code> status and returns the
message.  This value, in turn, is passed back as an argument to the
JavaScript success callback. In case of error, various status codes
are sent back to the JavaScript’s error callback.</p>

<h2 id="updating-the-jar-in-the-projects-www-directory">Updating the .jar in the Project’s www Directory</h2>

<p>The added <code class="language-plaintext highlighter-rouge">Echo.java</code> needs to be updated in your project.  To build
the <code class="language-plaintext highlighter-rouge">.jar</code> file, navigate to the BlackBerry WebWorks repo’s root
directory and run the <code class="language-plaintext highlighter-rouge">ant</code> command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ant update -Dproject.path="~/path_to_my_project"
</code></pre></div></div>

<p>This builds a new <code class="language-plaintext highlighter-rouge">.jar</code> file in the <code class="language-plaintext highlighter-rouge">build/ext</code> directory. Copy the
<code class="language-plaintext highlighter-rouge">build/ext/cordova.jar</code> file into the <code class="language-plaintext highlighter-rouge">project/www/ext</code> directory.</p>

<p>If all goes well, that allows you to use the <code class="language-plaintext highlighter-rouge">Echo</code> plugin in
BlackBerry.</p>
