<h1 id="ubuntu-platform-guide">Ubuntu Platform Guide</h1>

<p>This guide shows how to set up a development environment for creating Cordova applications for Ubuntu.</p>

<p>You will need an Ubuntu system for building applications, either running natively or in a virtual machine. You will also need an Ubuntu phone for testing your application, though an emulator can be used for basic verifications.</p>

<h2 id="development-platform-requirements">Development Platform Requirements</h2>

<h3 id="minimum-and-recommended-versions">Minimum and Recommended Versions</h3>

<p>Developing Cordova apps requires a system running Ubuntu.</p>

<p>The recommended environment is Ubuntu 16.04 LTS, running NodeJS 4.2.x and NPM 2.15.x.</p>

<p>Packages are still available for systems running the previous LTS release (14.04) but some components like NodeJS or phablet-shell may not support all of the latest options.</p>

<p>The target environment is an Ubuntu phone, supporting at least the ubuntu-sdk-api-15.04 framework. All phones on the market, or development images, support that framework by default.</p>

<p>The cordova-ubuntu platform support code requires at least cordova-cli 4.3.1. This is the minimum and recommended version at the time of this writing. cordova-ubuntu 4.3.x releases are all compatible with that tool release.</p>

<p>For the latest information on Cordova app support for Ubuntu runtime platforms,
see <a href="http://wiki.ubuntu.com/Cordova">wiki.ubuntu.com/Cordova</a>.</p>

<h2 id="installing-the-development-environment">Installing the Development Environment</h2>

<h3 id="install-ubuntu">Install Ubuntu</h3>

<p>Installation images of Ubuntu 16.04 LTS are available at http://www.ubuntu.com/download</p>

<p>The simplest option is to download an Ubuntu Desktop image.</p>

<p>In any case, the Debian packaging system will ensure that all underlying dependencies for the development environment will be installed. This lets you also install a build environment from an Ubuntu server installation as well.</p>

<h3 id="ubuntu-virtual-machine-optional">Ubuntu Virtual Machine (optional)</h3>

<p>Ubuntu can also be used in a virtual machine.</p>

<p>You can get an Ubuntu instance on all of the leading public clouds. In fact, Ubuntu is the most popular cloud operating system (http://www.ubuntu.com/cloud/public-cloud). Running in the cloud will let you build your Cordova application. However you will still need to connect a local instance to a phone via USB for testing your app.</p>

<p>You can also install Ubuntu in local VM, with Virtualbox, VMWare or Parallels on either Windows or Mac OS. That configuration lets you re-direct a USB port inside the virtual machine, to let the Ubuntu build system access the Ubuntu phone hardware and install the app for testing.</p>

<p>Refer to the documentation for either your public cloud of choice, or the local virtual machine for the details of the installation procedure.</p>

<p>Once you have a basic Ubuntu VM set up, you can install the rest of the required elements below.</p>

<h3 id="node-and-npm">Node and NPM</h3>

<p>Ubuntu 16.04 LTS comes with the required versions of both NodeJS and NPM. To install simlpy do:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>nodejs npm
<span class="nv">$ </span>node <span class="nt">-v</span>
v.4.2.6
<span class="nv">$ </span>npm <span class="nt">-v</span>
2.15.6
</code></pre></div></div>

<h3 id="cordova-cli">Cordova CLI</h3>

<p>The Cordova command line interface can be installed either via npm, or you can use a pre-packaged version available specifically for Ubuntu.</p>

<p>The recommended installation path is to use the pre-packaged version for Ubuntu, as it generally contains Ubuntu specific fixes which may not all have been merged upstream.</p>

<p>Installing the cordova-cli deb package requires to:</p>
<ol>
  <li>Add the Ubuntu Cordova
<a href="https://launchpad.net/~cordova-ubuntu/+archive/ppa">Personal Package Archive</a>
to your Ubuntu system</li>
  <li>Install the cordova-cli package (and its dependencies)</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt-add-repository ppa:cordova-ubuntu/ppa
<span class="nv">$ </span><span class="nb">sudo </span>apt-get update
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>cordova-cli
</code></pre></div></div>

<h3 id="add-an-ubuntu-click-chroot">Add an Ubuntu “click chroot”</h3>

<p>The build environment needs to be separated from the developer’s environment, to prevent unwanted side effects and provide a clean, repeatable process.</p>

<p>Ubuntu devices currently use the click packaging system.</p>

<p>To produce click packages, a “click chroot” is required. It is a separate build environment designed to produce binaries, by having a build tools and dependencies contained inside a chroot.</p>

<p>Generally, a click chroot hosts cross-compilation tools which can produce binaries for a different architecture (like armhf) than the one of the developer’s system (generally x86).</p>

<p>Last, the click chroot will need to be provisionned with libraries, or more generally “frameworks”, corresponding to the target environment.</p>

<p>Ubuntu devices will support the ubuntu-sdk-15.04 framework or later versions.</p>

<h3 id="create-a-click-chroot-environment">Create a click chroot environment</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt-add-repository ppa:ubuntu-sdk-team/ppa
<span class="nv">$ </span><span class="nb">sudo </span>apt-get update
<span class="c"># this will create a clean click chroot build environment</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>click-dev phablet-tools ubuntu-sdk-api-15.04
</code></pre></div></div>

<h3 id="add-build-dependencies-for-cordova">Add build dependencies for Cordova</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># add build dependencies inside the click chroot</span>
<span class="nb">sudo </span>click <span class="nb">chroot</span> <span class="nt">-a</span> armhf <span class="nt">-f</span> ubuntu-sdk-15.04 <span class="nb">install </span>cmake libicu-dev:armhf pkg-config qtbase5-dev:armhf qtchooser qtdeclarative5-dev:armhf qtfeedback5-dev:armhf qtlocation5-dev:armhf qtmultimedia5-dev:armhf qtpim5-dev:armhf libqt5sensors5-dev:armhf qtsystems5-dev:armhf
</code></pre></div></div>

<h3 id="ubuntu-ide-optional">Ubuntu IDE (optional)</h3>

<p>You may also want to install the Ubuntu QtCreator development environment. See
<a href="http://developer.ubuntu.com">developer.ubuntu.com</a> for more info. (The
QtCreator SDK is not required to add Ubuntu platform support to your Cordova
app.)</p>

<h2 id="project-workflow">Project Workflow</h2>

<p>To test your installation, or simply to start developing an application, you can follow the steps below.</p>

<h3 id="create-a-project">Create a project</h3>

<p>Creates an app in a <code class="language-plaintext highlighter-rouge">hello</code> directory whose display name is
<code class="language-plaintext highlighter-rouge">HelloWorld</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova create helloworld helloworld.ubuntudeveloper HelloWorld
<span class="nv">$ </span><span class="nb">cd </span>hello
<span class="nv">$ </span>cordova platform add ubuntu
</code></pre></div></div>

<p>Note that Ubuntu applications use a pair <appname>.<username> as a naming convention.</username></appname></p>

<h3 id="add-a-plugin">Add a Plugin</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova plugin add cordova-plugin-camera
</code></pre></div></div>

<h3 id="build-for-ubuntu-devices">Build for Ubuntu devices</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova build <span class="nt">--device</span>
</code></pre></div></div>

<p>You can see detailed build logs with the following options:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova <span class="nt">-d</span> build <span class="nt">--device</span> <span class="nt">--</span> <span class="nt">--verbose</span>
</code></pre></div></div>

<p>You can build your app for a different target framework by specifying the option below:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova <span class="nt">-d</span> build <span class="nt">--device</span> <span class="nt">--</span> <span class="nt">--framework</span><span class="o">=</span>ubuntu-sdk-16.04
</code></pre></div></div>

<p>Note that for the latter to work, you will need to have a corresponding click chroot installed on your build system.</p>

<h3 id="run-the-app-on-an-ubuntu-device">Run the App on an Ubuntu device</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova run <span class="nt">--device</span>
</code></pre></div></div>

<p>This will:</p>
<ol>
  <li>build the app for the device target</li>
  <li>package it using the click packaging system</li>
  <li>transfer the app on the device</li>
  <li>stop the app if it was already running</li>
  <li>install the app</li>
  <li>start the app</li>
</ol>

<h2 id="debugging">Debugging</h2>

<p>You can enable chrome devtools support to debug your app, by adding the –debug flag:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova run <span class="nt">--device</span> <span class="nt">--debug</span>
</code></pre></div></div>

<p>Then simply connect to the URL mentioned in the logs.</p>

<h2 id="publishing-your-app">Publishing your app</h2>

<p>Once you have finished developing and testing your app, you can publish it on the Ubuntu App Store.</p>

<h3 id="generate-and-verify-the-package">Generate and verify the package</h3>

<p>Your app is already packaged in a format compatible with the app store. Just find the .click package generate by the cordova-ubuntu build system:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cordova build <span class="nt">--device</span>
<span class="nv">$ </span>find <span class="nt">-name</span> <span class="s2">"*.click"</span>
</code></pre></div></div>

<p>You can manually verify that the package passes all verification steps enforced by the Ubuntu App Store system, by using the click-reviewer-tools:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>click review <span class="nt">-v</span> &lt;click file&gt;
</code></pre></div></div>

<p>Note: this step is done automatically by the build system as well.</p>

<h3 id="sign-up-and-upload-to-the-app-store">Sign up and upload to the app store</h3>

<p>You need to first create a free developer account on the Ubuntu App Store.</p>

<p>Then you will be able to upload your package to the store and make it available to all users of Ubuntu devices.</p>

<p>The full process is documented online at https://developer.ubuntu.com/en/publish/</p>

